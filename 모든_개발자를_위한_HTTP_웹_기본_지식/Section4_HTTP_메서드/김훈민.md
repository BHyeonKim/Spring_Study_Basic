# Section 4. HTTP 메서드

## 0. http 메서드

http api 를 설계한다고 생각해보자.

요구사항 회원정보 관리 api 만들어라 하면 아래와같은 것들을 할 줄 알아야하는거임.

api uri 설계를 다음과 같이 했어.

회원 목록 조회는 read member list 회원 조회는 read member by id 이렇게 uri 를 만들었어 이것이 과연 좋은 설계일까??

가장중요하는 것은 리소스 식별임. 리소스가 뭘까? 리소스는 회원을 등록하고 수정하고 조회하는게 리소스가 아니야.

미네랄을 캐라 라고 하면 미네랄이 리소스지 캐라가 리소스가 아니야. 회원 정보 조회는 회원이라는 개념 자체가 바로 리소스가 되는거임.

회원 목록 조회, 회원 조회, 회원 등록 전부 회원이 리소스임.

그렇기 때문에 계층적 구조로 리소스를 짜야함.

회원 목록 조회는 members 라고 하는거고 회원 조회는 members id 이렇게 하는거임.

근데 문제는 회원 등록 수정 삭제 이거는 어떻게 구분하지 하는 문제가 생긴다. 

리소스라는 거만 가지고 uri 를 설계하면 거기서 딱 막히게 된다. 그래서 http method 를 알아야하는것임. uri 는 무조건 리소스만 식별해야함. 리소스와 리소스를 대상으로 하는 행위 자체는 분리 되어야함. 리소스는 회원이고 행위는 조회 등록 삭제 변경 같은거임. 즉 uri 는 리소스만 식별한다면 http 메서드가 조회 등록 삭제 변경의 역할을 대신 해주게 되는것임.

먼저 Get 과 post 에 대해서 알아보자. get 은 뭔가 달라는거고 post 는 내가 줄테니 먼가 처리해달라는것이다.

파일을 어디에 넣는데 폴더안에 같이 파일이 있으면 그냥 덮어버리잖아 그게 put 이야.

patch 는 리소스의 부분만 변경해준다.

head 는 get 이랑 동일한데, http 바디 빼고 헤더까지만 줘. 하는거고

option 은 cors 에서만 사용함 그냥 이런게 잇다고 알면됨 나머지 2개도 거의 사용 ㄴㄴ

## 1. HTTP 메서드 - GET, POST

get

get은 이름 그대로 리소스를 조회하는것임. get 메시지를 딱 까보면 서버가 아 멤버스의 100번을 달라는거구나 하고 서버가 json 메시지를 만들어서 응답을 해줌. 클라이언트에 응답을 해주는거지. 

post

클라이언트에서 서버로 데이터를 보내 그러면 서버가 그걸 받아서 처리함. 메시지 바디를 통해 서버에 메시지를 보내면 서버는 요청 메시지를 받아서 메시지 바디를 받아서 처리할수있는 모든 작업을 다 처리해줌.

요청 데이터를 어떻게 처리한다는 뜻일까?

html form 에 입력한 정보로 회원가입, 주문 등에서 사용

게시판, 뉴스 그룹, 메일링 리스트, 블로그 또는 유사한 기사 그룹에 메시지 게시.

핵심은 이 리소스 uri 에 post 요청이 오면 요청 데이터를 어떻게 처리할지 스스로 정해야함. post 는 즉 

1. 새 리소스 생성 또는 등록
2. 요청 데이터 처리
3. 다른 메서드로 처리하기 애매한 경우

등으로 나눌수 있음.

리소스만 가지고 uri 를 다 설계할순없음. 나머지는 컨트롤 uri 처럼 동사가 들어갈수밖에없어 start delivert 처럼

get 은 지원안하는 서버가 많기 때문에 post를 써야할때도 있음.

## 2. HTTP 메서드 - PUT, PATCH, DELETE

put 은 리소스를 대체 리소스가 없으면 생성

클라이언트는 구체적인 리소스를 식별해야함.

post는 /members 에 넣었음 100번에 만들어질지 200에 만들어질지 클라이언트가 모름.

근데 put 은 클라이언트가 member에 100에 넣겠다고 말하는거

그래서 클라이언트가 리소스를 알고있어야함.

파일이 파일을 덮어 씌우듯이 완전히 대체해버린다.

username과 age가 있을때 그냥 age 만 넣어주면 리소스를 덮어서 age 만 남아버림. username을 아예 삭제해버리는거지. put 은 리소스를 수정하는것이 아니라 기존의 리소스를 완전히 갈아치우는것이다.

리소스를 수정하려면 patch를 사용하면 된다.

patch로 age 만 해서 보내면 username 이 그대로 있고 age 만 딱 남음. http 에서 patch 를 못받을수도 있는데 그럴땐 Post 를 사용하면 된다.

## 3. HTTP 메서드의 속성

안전 safe ⇒ 호출해도 리소스를 변경하지 않는다. 예를들어 Get 같은 경우가 안전한거임 post put delete 같은 것들이 안안전한거임.

멱등 idempotent ⇒ 한번 호출하든 두번호출하든 100번호출하든 결과가 똑같아야함. put 도 멱등임. 클라이언트가 똑같은 파일을 계속 put 하면 당연히 결과가 똑같아. 첫번째 결과를 덮고 두번째 결과가 남고 이런식이니까. 결국 마지막에 남는 최종 결과는 똑같아.

delete 도 똑같음. 결국 삭제된 결과는 똑같음.

post 같은 경우는 멱등이아님. 결제를 계속하면 그게 똑같겟어? ㄴㄴ 다름. 배송을 두번 누르면 두번 호출되겟지 그것도 안되는거임.

이게 왜 필요해? 자동 복구 메커니즘을 생각을해봐. 서버가 timeout 등으로 정상 응답을 못주었을때 클라이언트가 같은 요청을 다시 계속 해도 괜찮을까? 멱등한넘들은 괜찮음. 그럴때 사용하는거임.

캐시가능 ⇒ 응답결과를 캐시해서 사용해도 되는가? 웹브라우저에 큰 이미지를 요청을하면 그걸 캐시해놓았다가 사용하면 좋잖아. 스펙상 get head post patch 도 가능한데 get head 정도만 사용함. post 랑 patch 로 본문 내용까지 캐시 키로 고려하려면 너무 힘듬. 그러나 Get 은 uri 만 캐시로 사용하면 쉽기 때문에 get 만 사용함.
