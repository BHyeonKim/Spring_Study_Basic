# Section 8. HTTP 헤더2 - 캐시와 조건부 요청

## 캐시 기본 동작

캐시가 없을때

star jpg를 요청했을때 헤더와 바디 포함해서 1.1 메가가 통과해서 나와

캐시 컨트롤 ⇒ max age가 60이면 60초동안은 유지됨. 즉 브라우저 캐시에 60초동안 유효. 

캐시 덕분에 캐시 가능 시간동안 네트워크를 사용하지 않아도 됨.

캐시 시간이 초과되면 당연히 서버를 통해서 데이터를 다시 조회하고 캐시를 갱신하는거임.

캐시 시간이 초과되면 두가지 상황이 나타남

서버에서 기존 데이터를 변경함, 서버에서 기존 데이터를 변경하지 않음.

서버에 있는 데이터와 내가 받은 브라우저 캐시의 기존 데이터와 똑같은지 검증하기 위해 검증헤더가 추가됨. last modifide는 이 데이터가 마지막에 수정된 최종 시간을 말하는것임.

그리고 응답결과를 캐시에 저장함. 데이터 최종 수정일을 브라우저 캐시에 저장하는거임.

데이터 최종 수정일이 똑같으면 데이터가 아직 수정되지 않은것임.

수정이 안되었으면 http 1.1 304 not modified 라고 하는거임 변경된게 없다고 알려주는거지. 그리고 헤더 메타 정보만 보냄 바디를 안보냄

클라이언트는 서버가 보낸 응답 헤더 정보로 캐시의 메타 정보를 갱신

클라이언트는 캐시에 저장되어 있는 데이터 재활용함.

## 검증 헤더와 조건부 요청

검증헤더를 통해서 조건부 요청 헤더를 보낼수있어

조건이 만족하면 200 조건이 만족하지 않으면 304 이런식으로 할 수 있는거임. 

If modified since 이후에 데이터가 수정이 되었으면? 임

만약 데이터가 수정되지 않았으면 변경되지않았다고 알려주고 헤더만 보내므로 용량 조금만듬

데이터가 변경되었으면, 모든 데이터 전송해주어야함.

근데 단점이있어, 1초미만 단위로 캐시 조정이 불가능하고

a 에서 b로 바꿧다가 다시 b에서 a로 바꾸면 날짜는 변경되었지만 실제 컨텐츠는 변경이 안되어있을수있어. 이런경우에도 전체 데이터를 다 다시 다운해

이경우 해쉬값을 이용해서 해결해. 데이터가 변경되면 해쉬해서 값이 같은지 보는거지 같으면 유지하고 다르면 다시하면 돼.

ETag 사용 예시임.

요청 2로 if none match로 해 만약 값이 똑같으면 실패한거 그러면 304하는거임. 그러면 데이터가 안바뀐거므로 http body가 없음

ETag 만 서버에 보내서 같으면 유지하고 다르면 다시 받음

캐시 제어 헤더

캐시 컨트롤 ⇒ 캐시 유효 시간(max age), 데이터는 캐시해도 되지만 이 캐시를 쓰기전에 조건부 요청을해서 서버한테 검증을 항상 하고 써 라고 하는게(no cache), 

Expires

만료시키는건데 이거보다 max age쓰는게 좋음.

검증헤더

조건부 요청 헤더는 5개있음

## 프록시 캐시

미국에 있는 원 서버에서 사용자가 데이터를 받으려면 너무 오래걸려 그렇기 때문에 프록시 캐시 서버를 두고 미국에 있는 서버로가는게 아니라 프록시 캐시 서버에 접근해서 데이터를 빨리 받는거야.

근데 캐시기때문에 첫번째 유저는 좀 느림. 대신 두번째 놈은 좀 빠름.

모두가 이 서버에 접속해서 사용하기 때문에 그 서버에 있는 캐시는 퍼블릭이고 웹브라우저에있는 캐시는 프라이빗임.

캐시지시어 그래서 프리빗이 있는거임. 아이디같은건 캐시되면 안되니까.

## 캐시무효화

확실한 캐시 무효화 응답

캐시 적용안해도 웹브라우저들이 알아서 임의로 캐시를 할수도 있어 그렇기때문에 캐시가 되면 안되는거에는 캐시 하면 안된다는 캐시 무효화 응답을 다 해주어야해.

저기에 있는것중 하나만 쓰는게 아니라 전부 다 써야 확실하게 무효화가 돼.

mus revalidate와 no cache는 은근 비슷해보여 하지만 다름.

no cache는 프록시 캐시를 통해 원서버로 가서 원서버가 응답을 해줌. 

근데 프록시 캐시와 원서버간 단절이 될수도 있어. 그래서 프록시 캐시에서 오류보단 오래된 데이터라도 보여주자라고 판단을 할때가 있어 이건 프록시 캐시 종류에 따라 다르겠지 어느 회사가 운영하는지에 따라 그래서 응답을 저렇게 해줌.

근데 must revalidate는 원서버에 접근할 수 없는경우 항상 오류를 보여줘. 옛날거라도 보여주는 no cache와는 좀 다름.

백엔드 개발자는 스프링, 웹 MVC, JSP, PHP, ASP.NET, Node.js, 파이썬 장고, 루비 온 레일즈와 같은 웹 프레임워크나 기술들을 사용함. 이러한 웹 기술들은 모두 http를 기반으로 구현

스프링 핵심 원리 - 기본편을 다 듣고 HTTP 기본 지식을 다 들으면 그다음에 스프링 웹 MVC 가능을 들을 수 있음.

JSP 사용 자체를 권장하지않고 다 스프링부트를 쓴대.

그래서 최신 실무 기술로 웹 애플리케이션을 만들어보면서 학습하고 싶으면 스프링 부트와 JPA 실무 완전 정복 로드맵 을 들으면 됨.

전체 코스 순서는 어떻게 듣는게 좋나요?

목표 : 최신 기술의 자바 백엔드 개발자

추천 코스

1. 스프링 입문
2. 스프링 핵심 원리 - 기본편
3. 모든 개발자를 위한 HTTP 웹 기본 지식
4. 스프링 부트와 JPA 실무 완전 정복 로드맵
    1. 타입 B - 야생형(추천)

그다음에 스프링 웹 MVC, 데이터 접근 기술 강의를 들으면 됨
