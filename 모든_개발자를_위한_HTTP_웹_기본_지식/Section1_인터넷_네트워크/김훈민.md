# Section 1. 인터넷 네트워크

## 0. 인터넷 통신

인터넷에서 컴퓨터 둘은 어떻게 통신할까?

클라이언트와 서버가 바로 붙어있으면 선 연결해서 hello world 보내면 돼

근데 문제는 지금 인터넷은 미국 한국도 통신 가능하단말야.

인터넷 망을 통해서 hello world를 보내는데 문제는 중간에 노드가 엄청 많고 다른 서버들도 엄청 많아, 문제는 내가 원하는 사람에게 어떤 규칙으로 어떻게 보내줄까를 알아야해.

그걸 이해하기 위해서는 먼저 IP(인터넷 프로토콜) 을 알아야한다.

## 1. IP(인터넷 프로토콜)

클라이언트와 서버는 특정 IP 주소를 부여받음.

IP라는 인터넷 프로토콜은 지정한 IP 주소에 데이터를 전달하며 패킷이라는 통신 단위로 전달을 하게 됨.

메시지를 그냥 보내는게 아니라, IP 패킷이라는 규칙이 있음.

그 패킷에는 출발지 목적지 메시지 해서 이렇게 보내는거다.

모든 노드가 그 패킷을 보고 아 이건 저기구나 이건 저기구나 하면서 특정 서버로 던져주는거임. 그렇게 가다보면 미국에 있는 친구에게 제대로 잘 도달을 하게 됨.

근데 이런 IP 프로토콜에는 한계가 있음.

1. 비연결성 ⇒ 내가 미국에 있는 친구에게 보내는데 패킷을 받을 대상이 없거나 해도 그래도 패킷이 날라감.
2. 비신뢰성 ⇒ 중간에 패킷이 사라지거나 여기저기 통과해서 오면서 패킷 순서가 엉망진창으로 오면..?

## 2. TCP, UDP

인터넷 프로토콜 스택의 4계층중에 전송계층에 해당하는 녀석이 TCP, UDP 이다.

우리가 생각했을때 머리에 들어오는 컴퓨터의 동작원리는 일단 맨위에 어플리케이션 계층이 있고 그 아래 os가 있고 그 아래 네트워크 인터페이스가 있다.

어플리케이션같은 경우에는 크롬 웹브라우저나 네트워크 게임 채팅 프로그램 등등이 있고 socket 라이브러리도 있다.

os계층에 tcp udp가 있는것이다.

채팅프로그램으로 헬로우 월드라는 메시지를 생성하면 소켓 라이브러리로 os계층에 보내고 거기서 tcp 정보를 생성하고 또 ip 관련 정보를 생성해서 붙이고 그런식.

그 다음에 이제 네트워크 인터페이스를 통해서 랜카드를 통해서 이더넷 프레임이라는게 포함되어서 나오고, 결국 그래서 하나의 메시지는 http, tcp, ip, 이더넷 프레임이 다 붙어서 나가게 되는거임.

ip 패킷 정보는 단순함. 출발지 ip, 목적지 ip , 기타 등등이 들어감.

ip 패킷 안에 tcp 세그먼트가 더 들어가는데 거기서 출발지 port, 목적지 port, 순서등이 들어가게 됨. 그러다보니 ip 패킷만으로는 해결이 안되었던 순서 문제가 이걸 통해 해결이 되곤 하는거임.

tcp 의 특징 전송 제어 프로토콜의 줄임말이 tcp 이다 보니까 여기에는 3가지 특징이 있음. 

연결지향 ⇒ 먼저 연결을 한 다음에 메시지를 보냄.

데이터 전달 보증 ⇒ 패킷을 보내고 중간에 소실되어도 내가 소실된지 알 수 있음.

순서 보장 ⇒ 순서를 보장해줌

그래서 tcp 는 신뢰할 수 있는 프로토콜임.

tcp 3 way handshake

tcp ip 프로토콜로 연결을 하면 먼저 클라이언트와 서버가 연결을 함.

syn 을 먼저 하면 서버가 syn하면서 ack도 해줘. 그러니까 서로 syn 을 보내고 서로 ack를 보내. 그렇기 때문에 서로 믿을 수 있는거야. 서로 연결이 되었다고 인식하는거임.

연결이 되고 나면 그다음에 데이터를 전송하게 됨.

만약 중간에 ack 를 누가 못받으면 연결이 안되었구나 하고 인식을하고 안보냄.

요즘은 ack 를 보낼때 데이터도 같이 보내곤 함. 3번단계일때

근데 이거는 가상으로 연결이 된거지 물리적으로 연결이 된건아니야. 물리적으로 연결이 되는거는 그냥 전기선자체가 연결이 되어있어야하는것이다.

서버와 클라이언트 사이에는 중간에 서버와 클라이언트를 수많이 거치면서 가는것이다.

그렇기 때문에 논리적으로만 연결이 된거지. 나를 위한 전용 랜선이 보장이 되어있는것이 아니기 때문이다.

순서보장

패킷1 패킷2 패킷3 순서로 전송 근데 순서 다르게 오면 거기서부터 다시 보내라고 하는거임.

그림보면 될듯.

이게 어떻게 가능하냐 tcp 프로토콜안에 아까 순서가 보장된다고 햇잖아 그래서 그래.

tcp 와 udp는 같은 계층, ip 바로 위에 있는 거야. 근데 udp는 기능이 없어.

하얀 도화지에 비유해. 정리하자면 거의 ip와 거의 같아. 근데 다른거는 port가 추가가돼. 근데 왜? tcp 에도 port가있는데 굳이..? 하나의 ip에서 여러 어플리케이션이  받으려면 이거는 게임용 패킷 이거는 음악용 패킷 이거를 구분하기 위해서 포트를 나눠서 쓰는거야.

이넘의 장점은 tcp 는 다 좋은데 3 핸드쉐이킹 하려면 시간이 걸리고 중간에 연결 보냈어 잘받았어 하는거랑 데이터 다 넣어서 보내려면 전송속도도 빠르게 만들기 어려움.

최적화 하려고 해도 잘 최적화가 안돼, 저 프로토콜은 tcp 는 이미 손을 못댄다.

내가 만약 최적화를 할 수 있으면 udp 를 사용하면 됨. 이넘이 최근에 각광을 받고있대.

웹브라우저에서 http 통신을 할때 tcp ip 핸드쉐이킹하려면 너무 오래걸리니까 그런것도 다 최적화하려고 http 3에서 udp 프로토콜을 잘 사용한대.

## 3. PORT

근데 한번에 둘 이상 연결해야 하면 어떻게하지?? 게임, 화상통화, 웹브라우저 요청 이거 전부 다 하려면 어떻게 해야해? 하나의 클라이언트가 여러개의 서버와 통신을 해야함.

통신을 하면 나한테 패킷들이 오는데 이거 게임패킷인지 화상통화 패킷인지 알 수 없게 돼. 그렇기 때문에 포트가 필요한 것이다.

즉 포트란 같은 ip 내에서 프로세스를 구분하는거고, 게임은 8090 포트, 화상통화는 21000포트, 이런식으로. 그림을 보면 알겠지만 포트번호가 클라이언트 서버가 같을 필요는 없음. http 는 80포트래.

## 4. DNS

ip는 기억하기가 어려움.

그리고 큰 문제는 ip는 변경될 수 있음. 그렇기 때문에 dns가 필요한것이다. 도메인 네임 시스템. 도메인 명은 구글.컴 이나 네이버.컴 같은것이다. 도메인은 사서 등록을 해야하는것이고, dns 를 사용하게 되면 dns server에 먼저 요청을 하면 dns server가 알려준다. 너가 접속하려 하는 구글은 아이피가 여기야 이런식으로. 마치 전화번호부 같은 역할을 한다.
