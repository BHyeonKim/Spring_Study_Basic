# 섹션 5

### 싱글톤 패턴이 필요한 이유?

- 현대의 스프링 애플리케이션은 대부분 웹 애플리케이션으로 웹 애플리케이션은 보통 여러 고객이 동시에 요청을한다.
- 우리가 만들었던 순수한 DI 컨테이너 (AppConfig 파일에서 @Configuration 어노테이션을 사용하지 않을 때)는 빈을 호출할 때마다 매번 새로운 객체를 생성한다.
- 이는 규모가 작은 프로젝트인 경우 큰 문제가 아닐 수 있지만, 규모가 큰 프로젝트에서는 이러한 부분 역시 간과할 수 없는 문제가 된다.
- 싱글톤 패턴으로 만들면 서버가 실행될 때 하나의 인스턴스만 생성이 되기 때문에 이러한 문제가 해소될 것.

### 스프링이 관리하지 않는 싱글톤 클래스는?

우리가 서비스가 실행될 때 마다 새로운 객체가 생성이 된다면 매번 객체가 생성되어 생기는 메모리 문제뿐만 아니라 동시에 여러 작업을 수행할 때 여러 문제가 생길 수도 있다.

**싱글톤 패턴의 문제점**

- 싱글톤 패턴을 구현하기 위해서는 추가적인 코드들이 필요하다.
- 의존관계 상 클라이언트가 싱글톤 패턴의 구현 클래스에 의존해야 되기 때문에 DIP를 위반하고 자연스럽게 OCP 역시 위반하기 때문에 우리가 지향하는 좋은 객체 지향 설계가 이뤄질 수 없다.
- 인스턴스를 생성하기 때문에 자식 클래스를 만들기 어렵고, 테스트 역시 용이하지 않다.

### 싱글톤 컨테이너

스프링 컨테이너는 우리가 생성하는 싱글톤 패턴의 문제점을 해결하면서, 스프링 빈이 항상 하나의 객체 인스턴스를 가지는 싱글톤 패턴을 만족한다.

그런데 이게 어떻게 되는걸까?

이것은 실제로 스프링 컨테이너를 생성할 때 우리가 만들었던 **스프링 환경 설정 파일을 그대로 사용해서 빈을 등록하는 것이 아니라** 환경 설정 클래스의 바이트코드를 조작해서 AppConfig **클래스를 상속받은 임의의 다른 클래스를 만들고 이를 스프링 빈으로 등록했기 때문이다.**

또한 내부적으로 빈을 호출할 때 스프링 빈이 등록되어 있지 않은 경우라면 스프링 빈을 생성하고 이미 존재하는 스프링 빈이라면 생성할 때 만든 객체를 반환해주는 방식으로 동작하기 때문에 우리가 만드는 싱글톤 클래스에서 생기는 문제점을 해결할 수 있었던 것이다.

`@Configuration` 을 붙이면 바이트코드를 조작하는 CGLIB 기술을 사용하여 싱글톤을 보장하지만 붙이지 않으면 `@Bean` 으로 설정한 것들은 스프링 빈 으로 등록되지만 싱글톤을 만족하지 않는다.
