# 08. 빈 생명주기 콜백

# 01. 빈 생명주기 콜백 시작

간단하게 끝내려면 간단하게 끝낼 수 있는데, 3가지 방법이 있고 거기에서 배울 점들이 있다.

애플리케이션 서버랑 DB랑 미리 커넥션을 해놓고 요청이 많으면 100개도 미리 잡아놓고 그렇게 한다.

그래서, 연결을 미리 해놓고 나중에 종료하려고 하면, 객체의 초기화와 종료 작업이 필요하게 된다.

`NetworkClient` 를 만들어서 테스트를 진행함.

그런데 실행해보면 결과가 예상한 것과 다르게 나와

생각해보면 객체를 생성할때 바로 url 정보가 들어갈리가 없긴해. 객체를 생성하는게 먼저고 그 다음에 외부에서 수정자 주입을 해서 `setUrl()` 이 호출이 되어야 url 정보가 들어가는거야.

스프링 빈은 다음과 같은 라이프사이클을 가져

객체 생성 된 후 ⇒ 의존 관계 주입

즉, 스프링 빈은 객체 생성, 의존 관계 주입 까지 다 되어야 그 다음에 필요한 데이터를 사용 할 수 있는 준비가 완료되는거야.

근데 문제는 우리가 의존관계 주입이 완료된 시점을 어떻게 알 수 있어?

그것을 스프링이 해준다.

스프링 빈의 이벤트 라이프 사이클을 보면 의존관계 주입이 완료된 다음에 “초기화 콜백” 을 준다.

소멸되기 직전에는 “소멸전 콜백” 도 준다.

근데 이 예시는 싱글턴에 대한 예시래.

생성자에서 다 하면 편한거 아니야?

아니야 역할과 책임을 분리하는거야. 생성은 생성만하고 초기화는 초기화만 하는거지.

# 02. 인터페이스 InitializingBean, DisposableBean

초기화 콜백과 소멸전 콜백을 인터페이스로 받을 수 있다.

`InitializingBean` 은 `afterPropertiesSet()` 메서드로 초기화를 지원한다.
`DisposableBean` 은 `destroy()` 메서드로 소멸을 지원한다.

중요한것은 단점이다

이 인터페이스는 스프링 전용 인터페이스이기 때문에 이 코드는 스프링 전용 인터페이스에 의존하고 있다.

또한 이 메서드들의 이름을 변경할 수 없고, 내가 코드를 고칠 수 없는 외부 라이브러리에 적용할 수 없다.

스프링 초창기에만 쓰고 거의 사용하지 않는다.

# 03. 빈 등록 초기화, 소멸 메서드 지정

```java
 @Configuration
 static class LifeCycleConfig {

	   @Bean(initMethod = "init", destroyMethod = "close")
		 public NetworkClient networkClient() {
				 NetworkClient networkClient = new NetworkClient();
	       networkClient.setUrl("http://hello-spring.dev");
				 return networkClient;
    }
}
```

이거 하나 추가하면 되긴하는데

메서드 이름도 자유롭게 할 수 있고

스프링 빈이 스프링 코드에 의존하지 않는다. 그리고 코드가 아니라 설정 정보를 사용하는 거라서 코드를 고칠 수 없는 외부 라이브러리에도 초기화, 종료 메서드를 적용할 수 있다는 큰 장점이 있다.

그런데, @Bean 으로 등록할때만 발생하는건데, Default 값이 문자로 되어 있어. inferred로.

이 기능은 close와 shutdown 이라는 메서드를 자동으로 호출해준다.

자동으로 종료 메서드를 호출해주니까 갑자기 내가 원하지 않았는데 종료되면 이걸 의심해보자

# 04. 어노테이션 @PostConstruct, @PreDestroy

스프링에서도 이 방법을 권장하고 있고 이방법을 그냥 쓰면 된다고 한다.

@PostConstruct ⇒ 생성이 되기 전에

@PreDestroy ⇒ 종료가 되기 전에

이렇게 어노테이션을 붙여주고 사용하면 되고 편리함.

스프링이 아닌 다른 컨테이너에서도 잘 동작하고, 컴포넌트 스캔과도 잘 어울린다.

유일한 단점은 외부 라이브러리에는 적용하지 못한다는 것이니까 만약 외부라이브러리를 초기화 종료해야하면 @Bean 의 기능을 사용하자!!
