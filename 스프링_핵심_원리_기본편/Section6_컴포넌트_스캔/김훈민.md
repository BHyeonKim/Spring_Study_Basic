# 06. 컴포넌트 스캔

# 01. 컴포넌트 스캔과 의존관계 자동 주입 시작하기

`@ComponentScan(excludeFilters = @ComponentScan.Filter(type = FilterType.*ANNOTATION*, classes = Configuration.class))`

이거를 사용하면 컴포넌트 스캔이 된다.

컴포넌트 스캔으로 다 뒤져서 스프링 빈으로 자동 등록하는데, 그 중에서 뺄 것을 지정해주는 부분이 `excludeFilters` 부분이다.

기본적으로, `@ComponentScan` 이 붙으면, 자동으로 등록을 해주는데, `@Configuration` 도 자동으로 등록이 된다. 그래서 안에 들어가보면.. 그 `@Configuration` 이 녀석도 `@Component` 라고 붙어있는 것을 확인할 수 있다.

자동으로 스프링이 등록을 해주는건 좋아, 근데 생각해보면 의존관계 주입은 어떻게 할꺼야?

기존의 `Appconfig`는 어떻게 멤버 서비스는 멤버 리포지토리를 의존관계 주입을 할까?

그래서 `@Autowired` 를 쓰는것이다?

생성자에 붙여주면 스프링이 알아서 찾아서 자동으로 넣어주게 된다.

내 빈이 자동으로 등록이되는데 의존관계도 자동으로 해주기 위해서 `@Autowired`를 쓰는거지

컴포넌트 스캔을 통해서 위에서 배운 것처럼 스프링이 @Component가 붙은 친구들을 찾아서 스프링 컨테이너의 스프링 빈 저장소에 등록을 한다.

그리고 의존 관계도 @Autowired 되어 있는 애들을 찾아서 주입한다.

같은 타입이 여러개가 있으면 충돌이 나는데 뒤에 가서 설명해주겠다고 하심.

# 02. 탐색 위치와 기본 스캔 대상

우리가 적은 `@ComponentScan`에 우리가 탐색할 기본 위치를 지정할 수 있다.

```java
@ComponentScan(
    basePackages = "hello.core",
}
```

이렇게 하면 된다!

지정을 안하면 어떻게 될까?? 디폴트가 굉장히 중요해.

`@ComponentScan` 을 적어준 놈의 패키지부터 뒤진다.

그래서, 설정 정보 클래스의 위치를 프로젝트 최상단에 주로 둔다고 하심.

이렇게 두고, 불필요한 것은 위에서 배운 exclude를 사용해서 빼버리면서 사용하는 추세라고 한다.

나중에 예외, DB 관련해서 강의를 더 찍을 건데 이해안되면 그냥 그렇구나 하고 듣기만 하래.

음.. 그렇구나..

# 03. 필터

이름 그대로 위에서 한것처럼, `includeFilter`, `excludeFilters`가 있다.

Bean A 와 Bean B를 만들고, 테스트를 진행했다.

신기한점은 Annotation을 내가 저렇게 등록 해두면, 사용할 수 있다는 점이다.

ExcludeComponent로 등록을 하면 등록이 안되고

IncludeComponent를 해두면 등록이 된다.

필터 옵션은 5가지 종류가 있다.

# 04. 중복 등록과 충돌

컴포넌트 스캔에서 같은 빈 이름을 등록하면 문제가 생길 수 있다.

### 자동 빈 등록 vs 자동 빈 등록 하는 상황

`ConflictingBeanDefinitionException` 예외가 발생한다.

### 수동 빈 등록 vs 자동 빈 등록

테스트를 해보니 수동 빈이 우선권을 가지는거 같은데?

확인해보니 수동 빈 등록이 우선권을 갖는다. 수동 빈이 자동빈을 오버라이딩 해버리기 때문이다.

이부분이 정말 애매하고 중요한데, 개발자가 보통 이걸 의도하고 만들지는 않기 때문에 정말 잡기 어려운 버그가 만들어진다.

그래서 최근 스프링 부트에서는 수동 빈 등록과 자동 빈 등록이 충돌나면 오류가 발생하도록 기본 값을 바꾸었다고 한다!
